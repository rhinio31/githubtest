# --- Add AWS_DEFAULT_PROFILE to Git Bash prompt safely (keeps venv + colors) ---

# Function to add AWS profile text to current PS1, without overwriting anything
__aws_add_to_prompt() {
  # Work on a copy of the existing prompt
  local ps1_current="$PS1"

  # Only modify if AWS_DEFAULT_PROFILE is set
  if [ -n "$AWS_DEFAULT_PROFILE" ]; then
    # Remove any existing AWS info before re-adding it
    ps1_current=$(echo "$ps1_current" | sed -E 's/ \(AWS:[^)]+\)//')

    # Add AWS profile info just before the final $
    ps1_current="${ps1_current%%\\\$*} (AWS:${AWS_DEFAULT_PROFILE})\$ "
  fi

  PS1="$ps1_current"
}

# Wrap it around the existing PROMPT_COMMAND chain
if [[ $PROMPT_COMMAND != *"__aws_add_to_prompt"* ]]; then
  PROMPT_COMMAND="${PROMPT_COMMAND:+$PROMPT_COMMAND; }__aws_add_to_prompt"
fi
