# --- Append AWS_DEFAULT_PROFILE to Git Bash default prompt safely ---

# Save the original PROMPT_COMMAND so we can call it
__orig_prompt_command="$PROMPT_COMMAND"

# Create a custom function to rebuild PS1 cleanly each time
__aws_extend_prompt() {
  # Let Git Bash set up its normal PS1 first
  if [ -n "$__orig_prompt_command" ]; then
    eval "$__orig_prompt_command"
  fi

  # Keep the current PS1 (built by Git Bash)
  local base_prompt="$PS1"

  # If AWS_DEFAULT_PROFILE is set, insert it before the final $
  if [ -n "$AWS_DEFAULT_PROFILE" ]; then
    PS1="${base_prompt%%\\\$*} (${AWS_DEFAULT_PROFILE})\$ "
  else
    PS1="$base_prompt"
  fi
}

# Replace PROMPT_COMMAND with our custom wrapper
PROMPT_COMMAND="__aws_extend_prompt"
